<!doctype html>
<html lang="en">
    <head>
        <title>Title</title>
        <!-- Required meta tags -->
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />

        <!-- Bootstrap CSS v5.2.1 -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            crossorigin="anonymous"
        />
        <script src="https://code.jquery.com/jquery-4.0.0.js" integrity="sha256-9fsHeVnKBvqh3FB2HYu7g2xseAZ5MlN6Kz/qnkASV8U=" crossorigin="anonymous"></script>
    </head>

    <body>
        <header>
            <!-- place navbar here -->
        </header>
        <main>
            <div class="container mt-5">
                <table class="table table-striped" id="musica">
                    <thead class="table-dark">
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Portada</th>
                            <th scope="col">Nombre</th>
                            <th scope="col">Duracion</th>
                            <th scope="col">Genero</th>
                            <th scope="col">Artista</th>
                            <th scope="col">Acciones</th>

                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </main>
        <footer>
            <!-- place footer here -->
        </footer>
        
        <!-- Modal -->
        <div
            class="modal fade"
            id="modalId"
            tabindex="-1"
            role="dialog"
            aria-labelledby="modalTitleId"
            aria-hidden="true"
        >
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="modalTitleId">
                            Modal title
                        </h5>
                        <button
                            type="button"
                            class="btn-close"
                            data-bs-dismiss="modal"
                            aria-label="Close"
                        ></button>
                    </div>
                    <div class="modal-body">
                        <div class="container-fluid">
                            <form action="" method="post">
                                <label for="">Nombre</label>
                                <input type="hidden" id="id" name="id">
                                <input type="text" name="nombre" id="nombre" class="form-control mb-2">
                                <label for="">Duracion</label>
                                <input type="text" name="duracion" id="duracion" class="form-control mb-2">
                                <label for="">Genero</label>
                                <input type="text" name="genero" id="genero" class="form-control mb-2">
                                <label for="">Artista</label>
                                <input type="text" name="artista" id="artista" class="form-control mb-2">
                            </form>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button
                            type="button"
                            class="btn btn-secondary"
                            data-bs-dismiss="modal"
                        >
                            Close
                        </button>
                        <button type="button" class="btn btn-primary" onclick="saveCancion()">Save</button>
                    </div>
                </div>
            </div>
        </div>
        

        <!-- Bootstrap JavaScript Libraries -->
        <script
            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"
        ></script>

        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
            integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
            crossorigin="anonymous"
        ></script>
        <script>
            (function () {
                var modalEl = document.getElementById('modalId');
                if (modalEl) {
                    modalEl.addEventListener('show.bs.modal', function (event) {
                        var button = event.relatedTarget;
                        if (button) {
                            var recipient = button.getAttribute('data-bs-whatever');
                        }
                    });
                }

                function loadMusica() {
                    $.ajax({
                        method: "get",
                        url: "https://6985235c6964f10bf2527597.mockapi.io/musica"
                    }).done(function (msg) {
                        console.log(msg);
                        $('#musica tbody').empty();
                        msg.forEach(function (cancion) {
                            $('#musica tbody').append(
                                '<tr>' +
                                '<th scope="row">' + cancion.id + '</th>' +
                                '<td><img src="' + (cancion.portada || '') + '" width="50"/></td>' +
                                '<td>' + (cancion.nombre || '') + '</td>' +
                                '<td>' + (cancion.duracion || '') + '</td>' +
                                '<td>' + (cancion.genero || '') + '</td>' +
                                '<td>' + (cancion.artista || '') + '</td>' +
                                '<td><button class="btn btn-danger btn-sm" onClick="eliminarCancion(' + cancion.id + ')">Eliminar</button> <button class="btn btn-warning btn-sm" onClick="editarCancion(' + cancion.id + ')">Editar</button></td>' +
                                '</tr>'
                            );
                        });
                    });
                }

                window.eliminarCancion = function (id) {
                    $.ajax({
                        method: "delete",
                        url: "https://6985235c6964f10bf2527597.mockapi.io/musica/" + id
                    }).done(function (msg) {
                        alert("Cancion eliminada");
                        loadMusica();
                        location.reload();
                    });
                };

                window.editarCancion = function (id) {
                    var modal = new bootstrap.Modal(document.getElementById('modalId'));
                    $.ajax({
                        method: "get",
                        url: "https://6985235c6964f10bf2527597.mockapi.io/musica/" + id
                    }).done(function (msg) {
                        $('#id').val(msg.id);
                        $('#nombre').val(msg.nombre);
                        $('#duracion').val(msg.duracion);
                        $('#genero').val(msg.genero);
                        $('#artista').val(msg.artista);
                        modal.show();
                    });
                };

                window.saveCancion = function () {
                    var id = $('#id').val();
                    var cancion = {
                        nombre: $('#nombre').val(),
                        duracion: $('#duracion').val(),
                        genero: $('#genero').val(),
                        artista: $('#artista').val()
                    };
                    if (id) {
                        $.ajax({
                            method: "put",
                            url: "https://6985235c6964f10bf2527597.mockapi.io/musica/" + id,
                            data: cancion
                        }).done(function (msg) {
                            alert("Cancion actualizada");
                            location.reload();
                        });
                    } else {
                        $.ajax({
                            method: "post",
                            url: "https://6985235c6964f10bf2527597.mockapi.io/musica",
                            data: cancion
                        }).done(function (msg) {
                            alert("Cancion guardada");
                            location.reload();
                        });
                    }
                };

                $(document).ready(function () {
                    loadMusica();
                });
            })();
        </script>
    </body>
</html>
