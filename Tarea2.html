<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Guerras Hist贸ricas</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</head>
<body>

<div class="container mt-5">

  <h1 class="mb-4">Guerras Hist贸ricas</h1>

  <!-- Bot贸n Nueva Guerra -->
  <div class="text-end mb-3">
    <button class="btn btn-success" id="btnNew">+ Nueva Guerra</button>
  </div>

  <!--  Buscador -->
  <div class="row mb-3">
    <div class="col-md-6">
      <input type="text" id="searchInput" class="form-control" placeholder="Buscar por nombre, ubicaci贸n o resultado...">
    </div>
  </div>

  <table class="table table-bordered table-hover">
    <thead class="table-dark">
      <tr>
        <th>Nombre</th>
        <th>Fecha</th>
        <th>Ubicaci贸n</th>
        <th>Resultado</th>
        <th style="width: 200px;">Acciones</th>
      </tr>
    </thead>
    <tbody id="warTable"></tbody>
  </table>
</div>

<!-- Modal Editar -->
<div class="modal fade" id="editModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="editForm">
        <div class="modal-header">
          <h5 class="modal-title">Editar Guerra</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">

          <input type="hidden" id="editId">

          <div class="mb-3">
            <label>Nombre</label>
            <input type="text" class="form-control" id="editName" required>
          </div>

          <div class="mb-3">
            <label>Fecha Inicio</label>
            <input type="text" class="form-control" id="editStartDate" required>
          </div>

          <div class="mb-3">
            <label>Ubicaci贸n</label>
            <input type="text" class="form-control" id="editLocation" required>
          </div>

          <div class="mb-3">
            <label>Resultado</label>
            <input type="text" class="form-control" id="editResult" required>
          </div>

          <div class="mb-3">
            <label>Descripci贸n</label>
            <textarea class="form-control" id="editDescription" rows="3" required></textarea>
          </div>

        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Guardar</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal Crear -->
<div class="modal fade" id="createModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="createForm">
        <div class="modal-header">
          <h5 class="modal-title">Crear Nueva Guerra</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">

          <div class="mb-3">
            <label>Nombre</label>
            <input type="text" class="form-control" id="createName" required>
          </div>

          <div class="mb-3">
            <label>Fecha Inicio</label>
            <input type="text" class="form-control" id="createStartDate" required>
          </div>

          <div class="mb-3">
            <label>Ubicaci贸n</label>
            <input type="text" class="form-control" id="createLocation" required>
          </div>

          <div class="mb-3">
            <label>Resultado</label>
            <input type="text" class="form-control" id="createResult" required>
          </div>

          <div class="mb-3">
            <label>Descripci贸n</label>
            <textarea class="form-control" id="createDescription" rows="3" required></textarea>
          </div>

        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">Crear</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>

const apiURL = "https://698d3181b79d1c928ed4a9ac.mockapi.io/guerras";

$(document).ready(function() {

  loadData();

  function loadData() {
    $.get(apiURL, function(data) {

      let rows = "";

      data.forEach(war => {
        rows += `
          <tr>
            <td>${war.name}</td>
            <td>${war.start_date}</td>
            <td>${war.location}</td>
            <td>${war.result}</td>
            <td>
              <button class="btn btn-warning btn-sm btn-edit me-2" data-id="${war.id}">Editar</button>
              <button class="btn btn-danger btn-sm btn-delete" data-id="${war.id}">Eliminar</button>
            </td>
          </tr>
        `;
      });

      $("#warTable").html(rows);
    });
  }

  //  BUSCADOR EN TIEMPO REAL
  $("#searchInput").on("keyup", function() {

    let value = $(this).val().toLowerCase();

    $("#warTable tr").each(function() {

      let rowText = $(this).text().toLowerCase();

      if (rowText.includes(value)) {
        $(this).show();
      } else {
        $(this).hide();
      }

    });

  });

  // Crear
  $("#btnNew").click(function() {
    $("#createForm")[0].reset();
    new bootstrap.Modal(document.getElementById('createModal')).show();
  });

  $("#createForm").submit(function(e) {
    e.preventDefault();

    $.post(apiURL, {
      name: $("#createName").val(),
      start_date: $("#createStartDate").val(),
      location: $("#createLocation").val(),
      result: $("#createResult").val(),
      description: $("#createDescription").val()
    }, function() {
      bootstrap.Modal.getInstance(document.getElementById('createModal')).hide();
      loadData();
    });
  });

  // Editar
  $(document).on("click", ".btn-edit", function() {
    const id = $(this).data("id");

    $.get(apiURL + "/" + id, function(war) {
      $("#editId").val(war.id);
      $("#editName").val(war.name);
      $("#editStartDate").val(war.start_date);
      $("#editLocation").val(war.location);
      $("#editResult").val(war.result);
      $("#editDescription").val(war.description);

      new bootstrap.Modal(document.getElementById('editModal')).show();
    });
  });

  $("#editForm").submit(function(e) {
    e.preventDefault();

    const id = $("#editId").val();

    $.ajax({
      url: apiURL + "/" + id,
      method: "PUT",
      data: {
        name: $("#editName").val(),
        start_date: $("#editStartDate").val(),
        location: $("#editLocation").val(),
        result: $("#editResult").val(),
        description: $("#editDescription").val()
      },
      success: function() {
        bootstrap.Modal.getInstance(document.getElementById('editModal')).hide();
        loadData();
      }
    });
  });

  // Eliminar
  $(document).on("click", ".btn-delete", function() {
    const id = $(this).data("id");

    if (confirm("驴Seguro que deseas eliminar esta guerra?")) {
      $.ajax({
        url: apiURL + "/" + id,
        method: "DELETE",
        success: function() {
          loadData();
        }
      });
    }
  });

});

</script>

</body>
</html>